#!/usr/bin/env bash
# Adds custom header and redirect to Nginx config

# Install nginx if not installed
sudo apt-get update
sudo apt-get -y install nginx

# Add the X-Served-By header to the default config
sudo sed -i '/server_name _;/a \\tadd_header X-Served-By \$hostname;' /etc/nginx/sites-enabled/default

# Add a location block for /redirect_me after server_name if not present
if ! grep -q "location = /redirect_me" /etc/nginx/sites-enabled/default; then
    sudo sed -i '/server_name _;/a \\n\tlocation = /redirect_me {\n\t\treturn 301 https://www.blog.ehoneahobed.com;\n\t}' /etc/nginx/sites-enabled/default
fi

# Restart nginx
sudo service nginx restart
